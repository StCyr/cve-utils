#!/usr/bin/perl

use LWP::Simple;
use JSON::PP;
use Data::Dumper;

my ($vendor,$soft,$version)=@ARGV;

(defined $soft) or die "No software name given.";
(defined $vendor) or die "No vendor name given.";

my $cvesearch_url = "https://cve.circl.lu/api/search/" . $vendor . "/" . $soft;

my $json = get($cvesearch_url);

if ($json) {

   my $decoded_json = decode_json($json);
   my $found;

   # Parse the list of retrieved CVE and find which apply to our version
   if (scalar @$decoded_json) {

     foreach my $cve ( @$decoded_json ) { 
       my $vulnerable = $cve->{vulnerable_configuration};
       if ( grep /$vendor:$soft:$version/, @$vulnerable) { print "$cve->{id} (CVSS=$cve->{cvss}) Summary=$cve->{summary}\n"; $found++; }
     }

   }

   if (!defined $found) {
     print "No CVE found for software \"$soft\" version \"$version\" from \"$vendor\"\n";
   } 

} else {
   die "Error while trying to retrieve CVE's at $cvesearch_url";
} 
